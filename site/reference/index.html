
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.0">
    
    
      
        <title>Reference - liionpack</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8b42a75e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#liionpack" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="liionpack" class="md-header__button md-logo" aria-label="liionpack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            liionpack
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="liionpack" class="md-nav__button md-logo" aria-label="liionpack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    liionpack
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome to liionpack
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../code%20of%20conduct/" class="md-nav__link">
        Code of conduct
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Reference
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#liionpack" class="md-nav__link">
    liionpack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils" class="md-nav__link">
    batteryrig_utils
  </a>
  
    <nav class="md-nav" aria-label="batteryrig_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils.cell_scatter_plot" class="md-nav__link">
    cell_scatter_plot()
  </a>
  
    <nav class="md-nav" aria-label="cell_scatter_plot()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils.cell_scatter_plot--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils.cell_scatter_plot--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils.oversampling" class="md-nav__link">
    oversampling()
  </a>
  
    <nav class="md-nav" aria-label="oversampling()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils.oversampling--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.load_data" class="md-nav__link">
    load_data
  </a>
  
    <nav class="md-nav" aria-label="load_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.load_data.load_simulation_data" class="md-nav__link">
    load_simulation_data()
  </a>
  
    <nav class="md-nav" aria-label="load_simulation_data()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.load_data.load_simulation_data--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.load_data.load_simulation_data--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.netlist_utils" class="md-nav__link">
    netlist_utils
  </a>
  
    <nav class="md-nav" aria-label="netlist_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.read_netlist" class="md-nav__link">
    read_netlist()
  </a>
  
    <nav class="md-nav" aria-label="read_netlist()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.read_netlist--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.read_netlist--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.setup_circuit" class="md-nav__link">
    setup_circuit()
  </a>
  
    <nav class="md-nav" aria-label="setup_circuit()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.setup_circuit--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.setup_circuit--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.solve_circuit" class="md-nav__link">
    solve_circuit()
  </a>
  
    <nav class="md-nav" aria-label="solve_circuit()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.solve_circuit--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.solve_circuit--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.protocols" class="md-nav__link">
    protocols
  </a>
  
    <nav class="md-nav" aria-label="protocols">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.protocols.generate_protocol" class="md-nav__link">
    generate_protocol()
  </a>
  
    <nav class="md-nav" aria-label="generate_protocol()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.protocols.generate_protocol--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.protocols.generate_protocol--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.protocols.test_protocol" class="md-nav__link">
    test_protocol()
  </a>
  
    <nav class="md-nav" aria-label="test_protocol()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.protocols.test_protocol--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.sim_utils" class="md-nav__link">
    sim_utils
  </a>
  
    <nav class="md-nav" aria-label="sim_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.create_init_funcs" class="md-nav__link">
    create_init_funcs()
  </a>
  
    <nav class="md-nav" aria-label="create_init_funcs()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.create_init_funcs--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.create_init_funcs--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.initial_conditions" class="md-nav__link">
    initial_conditions()
  </a>
  
    <nav class="md-nav" aria-label="initial_conditions()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.initial_conditions--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.initial_conditions--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.update_init_conc" class="md-nav__link">
    update_init_conc()
  </a>
  
    <nav class="md-nav" aria-label="update_init_conc()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.update_init_conc--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.update_init_conc--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.simulations" class="md-nav__link">
    simulations
  </a>
  
    <nav class="md-nav" aria-label="simulations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.simulations.create_simulation" class="md-nav__link">
    create_simulation()
  </a>
  
    <nav class="md-nav" aria-label="create_simulation()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.simulations.create_simulation--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.simulations.create_simulation--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.solver_utils" class="md-nav__link">
    solver_utils
  </a>
  
    <nav class="md-nav" aria-label="solver_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.solver_utils.solve" class="md-nav__link">
    solve()
  </a>
  
    <nav class="md-nav" aria-label="solve()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.solver_utils.solve--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.solver_utils.solve--raises" class="md-nav__link">
    Raises
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.solver_utils.solve--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.build_inputs_dict" class="md-nav__link">
    build_inputs_dict()
  </a>
  
    <nav class="md-nav" aria-label="build_inputs_dict()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.build_inputs_dict--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.build_inputs_dict--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.get_interpolated_htc" class="md-nav__link">
    get_interpolated_htc()
  </a>
  
    <nav class="md-nav" aria-label="get_interpolated_htc()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.get_interpolated_htc--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.get_interpolated_htc--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.interp_current" class="md-nav__link">
    interp_current()
  </a>
  
    <nav class="md-nav" aria-label="interp_current()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.interp_current--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.interp_current--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.read_cfd_data" class="md-nav__link">
    read_cfd_data()
  </a>
  
    <nav class="md-nav" aria-label="read_cfd_data()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.read_cfd_data--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.read_cfd_data--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#liionpack" class="md-nav__link">
    liionpack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils" class="md-nav__link">
    batteryrig_utils
  </a>
  
    <nav class="md-nav" aria-label="batteryrig_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils.cell_scatter_plot" class="md-nav__link">
    cell_scatter_plot()
  </a>
  
    <nav class="md-nav" aria-label="cell_scatter_plot()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils.cell_scatter_plot--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils.cell_scatter_plot--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils.oversampling" class="md-nav__link">
    oversampling()
  </a>
  
    <nav class="md-nav" aria-label="oversampling()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.batteryrig_utils.oversampling--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.load_data" class="md-nav__link">
    load_data
  </a>
  
    <nav class="md-nav" aria-label="load_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.load_data.load_simulation_data" class="md-nav__link">
    load_simulation_data()
  </a>
  
    <nav class="md-nav" aria-label="load_simulation_data()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.load_data.load_simulation_data--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.load_data.load_simulation_data--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.netlist_utils" class="md-nav__link">
    netlist_utils
  </a>
  
    <nav class="md-nav" aria-label="netlist_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.read_netlist" class="md-nav__link">
    read_netlist()
  </a>
  
    <nav class="md-nav" aria-label="read_netlist()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.read_netlist--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.read_netlist--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.setup_circuit" class="md-nav__link">
    setup_circuit()
  </a>
  
    <nav class="md-nav" aria-label="setup_circuit()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.setup_circuit--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.setup_circuit--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.solve_circuit" class="md-nav__link">
    solve_circuit()
  </a>
  
    <nav class="md-nav" aria-label="solve_circuit()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.solve_circuit--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.netlist_utils.solve_circuit--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.protocols" class="md-nav__link">
    protocols
  </a>
  
    <nav class="md-nav" aria-label="protocols">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.protocols.generate_protocol" class="md-nav__link">
    generate_protocol()
  </a>
  
    <nav class="md-nav" aria-label="generate_protocol()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.protocols.generate_protocol--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.protocols.generate_protocol--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.protocols.test_protocol" class="md-nav__link">
    test_protocol()
  </a>
  
    <nav class="md-nav" aria-label="test_protocol()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.protocols.test_protocol--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.sim_utils" class="md-nav__link">
    sim_utils
  </a>
  
    <nav class="md-nav" aria-label="sim_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.create_init_funcs" class="md-nav__link">
    create_init_funcs()
  </a>
  
    <nav class="md-nav" aria-label="create_init_funcs()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.create_init_funcs--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.create_init_funcs--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.initial_conditions" class="md-nav__link">
    initial_conditions()
  </a>
  
    <nav class="md-nav" aria-label="initial_conditions()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.initial_conditions--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.initial_conditions--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.update_init_conc" class="md-nav__link">
    update_init_conc()
  </a>
  
    <nav class="md-nav" aria-label="update_init_conc()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.update_init_conc--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.sim_utils.update_init_conc--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.simulations" class="md-nav__link">
    simulations
  </a>
  
    <nav class="md-nav" aria-label="simulations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.simulations.create_simulation" class="md-nav__link">
    create_simulation()
  </a>
  
    <nav class="md-nav" aria-label="create_simulation()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.simulations.create_simulation--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.simulations.create_simulation--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.solver_utils" class="md-nav__link">
    solver_utils
  </a>
  
    <nav class="md-nav" aria-label="solver_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.solver_utils.solve" class="md-nav__link">
    solve()
  </a>
  
    <nav class="md-nav" aria-label="solve()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.solver_utils.solve--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.solver_utils.solve--raises" class="md-nav__link">
    Raises
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.solver_utils.solve--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#liionpack.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.build_inputs_dict" class="md-nav__link">
    build_inputs_dict()
  </a>
  
    <nav class="md-nav" aria-label="build_inputs_dict()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.build_inputs_dict--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.build_inputs_dict--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.get_interpolated_htc" class="md-nav__link">
    get_interpolated_htc()
  </a>
  
    <nav class="md-nav" aria-label="get_interpolated_htc()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.get_interpolated_htc--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.get_interpolated_htc--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.interp_current" class="md-nav__link">
    interp_current()
  </a>
  
    <nav class="md-nav" aria-label="interp_current()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.interp_current--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.interp_current--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.read_cfd_data" class="md-nav__link">
    read_cfd_data()
  </a>
  
    <nav class="md-nav" aria-label="read_cfd_data()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.read_cfd_data--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liionpack.utils.read_cfd_data--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Reference</h1>
                
                <div class="doc doc-object doc-module">

<a id="liionpack"></a>
    <div class="doc doc-contents first">

      <p>=======
liionpack
=======</p>
<p>liionpack is a tool for simulating battery packs with pybamm. It can design the
pack with a combination of batteries connected in series and parallel or can
read a netlist.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-module">



<h2 id="liionpack.batteryrig_utils" class="doc doc-heading">
        <code>batteryrig_utils</code>



</h2>

    <div class="doc doc-contents ">

      <p>Created on Tue Feb 23 14:57:53 2021</p>
<p>@author: dominicdathan</p>



  <div class="doc doc-children">












  <div class="doc doc-object doc-function">



<h3 id="liionpack.batteryrig_utils.cell_scatter_plot" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cell_scatter_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">val_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cellno_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">text_prec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <h5 id="liionpack.batteryrig_utils.cell_scatter_plot--parameters">Parameters</h5>
<p>ax : matplotlib axis obj
    axis to plot on.
c : like plt.scatter c kwarg
    colors to plot scatter with.
val_text : bool
    write values on plot
cellno_text : bool
    write cell numbers on plot
batch_col :
    color cells by batch
text_prec : int
    precsition to write text of values on cells.
**kwargs : 
    plt.scatter kwargs.</p>
<h5 id="liionpack.batteryrig_utils.cell_scatter_plot--returns">Returns</h5>
<p>None.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\batteryrig_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cell_scatter_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">val_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="n">cellno_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">text_prec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : matplotlib axis obj</span>
<span class="sd">        axis to plot on.</span>
<span class="sd">    c : like plt.scatter c kwarg</span>
<span class="sd">        colors to plot scatter with.</span>
<span class="sd">    val_text : bool</span>
<span class="sd">        write values on plot</span>
<span class="sd">    cellno_text : bool</span>
<span class="sd">        write cell numbers on plot</span>
<span class="sd">    batch_col :</span>
<span class="sd">        color cells by batch</span>
<span class="sd">    text_prec : int</span>
<span class="sd">        precsition to write text of values on cells.</span>
<span class="sd">    **kwargs : </span>
<span class="sd">        plt.scatter kwargs.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">X_pos</span><span class="p">,</span> <span class="n">Y_pos</span> <span class="o">=</span> <span class="n">cell_XY_positions</span><span class="p">()</span>

    <span class="c1"># set size of markers</span>
    <span class="n">diameter</span> <span class="o">=</span> <span class="mf">21.44</span><span class="o">/</span><span class="mi">1000</span><span class="p">;</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">diameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">area</span><span class="o">*</span><span class="mi">4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># points </span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="mi">72</span><span class="o">/</span><span class="mf">0.0254</span><span class="o">*</span><span class="mi">1000</span> <span class="c1"># some scaling... </span>

    <span class="c1"># scatter plot</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_pos</span><span class="p">,</span> <span class="n">Y_pos</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># set limits</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.06</span><span class="p">,</span><span class="mf">0.06</span><span class="p">)</span>
    <span class="c1"># colorbar</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
    <span class="c1"># set axis equal</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_clim</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;cmap&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span>

    <span class="n">text_colors</span> <span class="o">=</span>  <span class="n">text_color</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="n">cmap</span><span class="p">)</span>
    <span class="c1"># write cell text</span>
    <span class="k">if</span> <span class="n">val_text</span><span class="p">:</span>
        <span class="n">cell_text</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">text_prec</span><span class="p">,</span><span class="n">text_colors</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cellno_text</span><span class="p">:</span>        
        <span class="n">cell_text_numbers</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">text_colors</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">batch_col</span><span class="p">:</span>
        <span class="n">cell_batch_color</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  <div class="doc doc-object doc-function">



<h3 id="liionpack.batteryrig_utils.oversampling" class="doc doc-heading">
<code class="highlight language-python"><span class="n">oversampling</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">derivative_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">adaptive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Give a file for the 2021 AMMBa battery testing a new file under an
oversampling directory is created. End tag of _ad signifies adaptive
oversampling was used.
Parameters</p>
<hr />
<p>file_name : str
    File name (with extension) to oversample found in the specified
    directory.
directory : str
    Directory where the specified file can be found. An oversampling folder
    will be created here.
N : int, optional
    Number of points to average together. The default is 100.
derivative_limit : float, optional
    Limit at which oversampling is conducted. A current derivative over
    this value will result in all data within N/2 points to be kept.
    The default is 10.
adaptive : bool, optional
    If adaptive sampling is used. Without all data will be over sampled
    and high derivative points may be missed. The default is True</p>
<h5 id="liionpack.batteryrig_utils.oversampling--returns">Returns</h5>
<p>None.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\batteryrig_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">oversampling</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">derivative_limit</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">adaptive</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Give a file for the 2021 AMMBa battery testing a new file under an</span>
<span class="sd">    oversampling directory is created. End tag of _ad signifies adaptive</span>
<span class="sd">    oversampling was used.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : str</span>
<span class="sd">        File name (with extension) to oversample found in the specified</span>
<span class="sd">        directory.</span>
<span class="sd">    directory : str</span>
<span class="sd">        Directory where the specified file can be found. An oversampling folder</span>
<span class="sd">        will be created here.</span>
<span class="sd">    N : int, optional</span>
<span class="sd">        Number of points to average together. The default is 100.</span>
<span class="sd">    derivative_limit : float, optional</span>
<span class="sd">        Limit at which oversampling is conducted. A current derivative over</span>
<span class="sd">        this value will result in all data within N/2 points to be kept.</span>
<span class="sd">        The default is 10.</span>
<span class="sd">    adaptive : bool, optional</span>
<span class="sd">        If adaptive sampling is used. Without all data will be over sampled</span>
<span class="sd">        and high derivative points may be missed. The default is True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oversampled_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;oversampled&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">oversampled_folder</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">oversampled_folder</span><span class="p">)</span>


    <span class="n">look_forward</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">look_back</span> <span class="o">=</span> <span class="n">look_forward</span> <span class="o">+</span> <span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span> <span class="n">skiprows</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">adaptive</span><span class="p">:</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">look_forward</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_temp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">ii</span> <span class="o">+=</span> <span class="n">N</span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ii</span><span class="o">+</span><span class="n">look_forward</span> <span class="o">&gt;</span> <span class="n">n_points</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ee</span> <span class="o">=</span> <span class="n">n_points</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ee</span> <span class="o">=</span> <span class="n">ii</span><span class="o">+</span><span class="n">look_forward</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="n">look_back</span><span class="p">,</span> <span class="n">ee</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

            <span class="n">df_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">df_temp</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">df_new</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_temp</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">ii</span> <span class="o">+=</span> <span class="n">N</span>
            <span class="k">if</span> <span class="n">ii</span> <span class="o">&gt;=</span> <span class="n">n_points</span><span class="p">:</span>
                <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">])</span>
        <span class="n">dT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">time</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">52</span><span class="p">:</span><span class="mi">68</span><span class="p">])))</span>
        <span class="n">dI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">current</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">dT</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dI</span> <span class="o">=</span> <span class="n">dI</span><span class="p">[</span><span class="n">dT</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dT</span> <span class="o">=</span> <span class="n">dT</span><span class="p">[</span><span class="n">dT</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>        

        <span class="n">derivative</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dI</span><span class="o">/</span><span class="n">dT</span><span class="p">)</span>
        <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dI</span><span class="p">)</span>

        <span class="n">save_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_points</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">derivative</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">derivative_limit</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">-</span><span class="n">look_back</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">bb</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bb</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="n">look_back</span>

                <span class="k">if</span> <span class="n">i</span><span class="o">+</span><span class="n">look_forward</span> <span class="o">&gt;</span> <span class="n">n_points</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ff</span> <span class="o">=</span> <span class="n">n_points</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ff</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">look_forward</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">ff</span><span class="p">))</span>

                <span class="n">save_points</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_points</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">save_points</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">save_points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">save_points</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="n">df_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="n">df_new</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_temp</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">idx</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">oversampled_folder</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="n">df_new</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.6g</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span>
</code></pre></div>
        </details>
    </div>

  </div>










  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="liionpack.load_data" class="doc doc-heading">
        <code>load_data</code>



</h2>

    <div class="doc doc-contents ">

      <p>Created on Thu Sep 23 10:29:24 2021</p>
<p>@author: Tom</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h3 id="liionpack.load_data.load_simulation_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_simulation_data</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;A25022021_2_D&#39;</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>A bespoke utility function to load in experimental data</p>
<h5 id="liionpack.load_data.load_simulation_data--parameters">Parameters</h5>
<p>data_dir : str
    The parent directory for the data file.
filename : str, optional
    The filename for the data. The default is 'A25022021_2_D'.</p>
<h5 id="liionpack.load_data.load_simulation_data--returns">Returns</h5>
<p>df : pandas.Dataframe
    An experimental data file</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\load_data.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_simulation_data</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;A25022021_2_D&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A bespoke utility function to load in experimental data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_dir : str</span>
<span class="sd">        The parent directory for the data file.</span>
<span class="sd">    filename : str, optional</span>
<span class="sd">        The filename for the data. The default is &#39;A25022021_2_D&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df : pandas.Dataframe</span>
<span class="sd">        An experimental data file</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">))</span>
    <span class="c1"># calculate zero currents</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">batteryrig_utils</span><span class="o">.</span><span class="n">zero_currents</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">batteryrig_utils</span><span class="o">.</span><span class="n">calc_cell_voltages</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span> <span class="mi">172</span>
    <span class="n">tmap</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">st</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">tmap</span><span class="p">]</span>
    <span class="n">tlow</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">tlow</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="liionpack.netlist_utils" class="doc doc-heading">
        <code>netlist_utils</code>



</h2>

    <div class="doc doc-contents ">

      <p>Created on Thu Sep 23 10:36:15 2021</p>
<p>@author: Tom</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h3 id="liionpack.netlist_utils.read_netlist" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_netlist</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">Ri</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">Rc</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">Rb</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">Rl</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mf">80.0</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="mf">4.2</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Assumes netlist has been saved by LTSpice with format Descriptor Node1 Node2 Value
Any lines starting with * are comments and . are commands so ignore them
Nodes begin with N so remove that
Open ended components are not allowed and their nodes start with NC (no-connection)</p>
<h5 id="liionpack.netlist_utils.read_netlist--parameters">Parameters</h5>
<p>filepath : str
    path to netlist circuit file '.cir'.
Ri : float
    Internal resistance (:math:<code>\Omega</code>). The default is 1e-2.
Rc : float
    Connection resistance (:math:<code>\Omega</code>). The default is 1e-2.
Rb : float
    Busbar resistance (:math:<code>\Omega</code>). The default is 1e-4.
Rl : float
    Long Busbar resistance (:math:<code>\Omega</code>). The default is 5e-4.
I : float
    Current (A). The default is 80.0.
V : float
    Initial battery voltage (V). The default is 4.2.</p>
<h5 id="liionpack.netlist_utils.read_netlist--returns">Returns</h5>
<p>netlist : pandas.DataFrame
    A netlist of circuit elements with format. desc, node1, node2, value.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\netlist_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">read_netlist</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">Ri</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">Rc</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">Rb</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">Rl</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mf">80.0</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="mf">4.2</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Assumes netlist has been saved by LTSpice with format Descriptor Node1 Node2 Value</span>
<span class="sd">    Any lines starting with * are comments and . are commands so ignore them</span>
<span class="sd">    Nodes begin with N so remove that</span>
<span class="sd">    Open ended components are not allowed and their nodes start with NC (no-connection)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : str</span>
<span class="sd">        path to netlist circuit file &#39;.cir&#39;.</span>
<span class="sd">    Ri : float</span>
<span class="sd">        Internal resistance (:math:`\Omega`). The default is 1e-2.</span>
<span class="sd">    Rc : float</span>
<span class="sd">        Connection resistance (:math:`\Omega`). The default is 1e-2.</span>
<span class="sd">    Rb : float</span>
<span class="sd">        Busbar resistance (:math:`\Omega`). The default is 1e-4.</span>
<span class="sd">    Rl : float</span>
<span class="sd">        Long Busbar resistance (:math:`\Omega`). The default is 5e-4.</span>
<span class="sd">    I : float</span>
<span class="sd">        Current (A). The default is 80.0.</span>
<span class="sd">    V : float</span>
<span class="sd">        Initial battery voltage (V). The default is 4.2.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    netlist : pandas.DataFrame</span>
<span class="sd">        A netlist of circuit elements with format. desc, node1, node2, value.</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="s1">&#39;.cir&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
        <span class="n">filepath</span> <span class="o">+=</span> <span class="s1">&#39;.cir&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lp</span><span class="o">.</span><span class="n">CIRCUIT_DIR</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">temp</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">temp</span>
    <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-16LE&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">Lines</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">Lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">Lines</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">]]</span>
    <span class="n">Lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U16&#39;</span><span class="p">)</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">Lines</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">N1</span> <span class="o">=</span> <span class="n">Lines</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">N2</span> <span class="o">=</span> <span class="n">Lines</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="c1"># values = Lines[:, 3]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">N1</span><span class="p">))</span>
    <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">N1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">N2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">netlist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;desc&#39;</span><span class="p">:</span> <span class="n">desc</span><span class="p">,</span> <span class="s1">&#39;node1&#39;</span><span class="p">:</span> <span class="n">N1</span><span class="p">,</span> <span class="s1">&#39;node2&#39;</span><span class="p">:</span> <span class="n">N2</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">values</span><span class="p">})</span>
    <span class="n">Ri_map</span> <span class="o">=</span> <span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Ri&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">Rc_map</span> <span class="o">=</span> <span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Rc&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">Rb_map</span> <span class="o">=</span> <span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Rb&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">Rl_map</span> <span class="o">=</span> <span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Rl&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">V_map</span> <span class="o">=</span> <span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">I_map</span> <span class="o">=</span> <span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">netlist</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Ri_map</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Ri</span>
    <span class="n">netlist</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Rc_map</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Rc</span>
    <span class="n">netlist</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Rb_map</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Rb</span>
    <span class="n">netlist</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Rl_map</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Rl</span>
    <span class="n">netlist</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">I_map</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">I</span>
    <span class="n">netlist</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">V_map</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">V</span>
    <span class="k">return</span> <span class="n">netlist</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="liionpack.netlist_utils.setup_circuit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">setup_circuit</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="n">Ns</span><span class="p">,</span> <span class="n">Ri</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">Rc</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">Rb</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">Rl</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mf">80.0</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="mf">4.2</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Define a netlist from a number of batteries in parallel and series</p>
<h5 id="liionpack.netlist_utils.setup_circuit--parameters">Parameters</h5>
<p>Np : int
    Number of batteries in parallel.
Ns : int
    Number of batteries in series.
Ri : float
    Internal resistance (:math:<code>\Omega</code>). The default is 1e-2.
Rc : float
    Connection resistance (:math:<code>\Omega</code>). The default is 1e-2.
Rb : float
    Busbar resistance (:math:<code>\Omega</code>). The default is 1e-4.
I : float
    Current (A). The default is 80.0.
V : float
    Initial battery voltage (V). The default is 4.2.
plot : bool, optional
    Plot the circuit. The default is False.</p>
<h5 id="liionpack.netlist_utils.setup_circuit--returns">Returns</h5>
<p>netlist : TYPE
    DESCRIPTION.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\netlist_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">setup_circuit</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="n">Ns</span><span class="p">,</span> <span class="n">Ri</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">Rc</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">Rb</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">Rl</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mf">80.0</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="mf">4.2</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Define a netlist from a number of batteries in parallel and series</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Np : int</span>
<span class="sd">        Number of batteries in parallel.</span>
<span class="sd">    Ns : int</span>
<span class="sd">        Number of batteries in series.</span>
<span class="sd">    Ri : float</span>
<span class="sd">        Internal resistance (:math:`\Omega`). The default is 1e-2.</span>
<span class="sd">    Rc : float</span>
<span class="sd">        Connection resistance (:math:`\Omega`). The default is 1e-2.</span>
<span class="sd">    Rb : float</span>
<span class="sd">        Busbar resistance (:math:`\Omega`). The default is 1e-4.</span>
<span class="sd">    I : float</span>
<span class="sd">        Current (A). The default is 80.0.</span>
<span class="sd">    V : float</span>
<span class="sd">        Initial battery voltage (V). The default is 4.2.</span>
<span class="sd">    plot : bool, optional</span>
<span class="sd">        Plot the circuit. The default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    netlist : TYPE</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">tic</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">Nc</span> <span class="o">=</span> <span class="n">Np</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">Nr</span> <span class="o">=</span> <span class="n">Ns</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nc</span> <span class="o">*</span> <span class="n">Nr</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">Nr</span><span class="p">,</span> <span class="n">Nc</span><span class="p">])</span>

    <span class="c1"># 1st column is terminals only</span>
    <span class="c1"># 1st and last rows are busbars</span>
    <span class="c1"># Other rows alternate between series resistor and voltage source</span>

    <span class="c1"># Build data  with [&#39;element type&#39;, Node1, Node2, value]</span>
    <span class="n">netlist</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">num_Rb</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_I</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_V</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">desc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">node1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">node2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Current source - same end</span>
    <span class="c1"># netline = []</span>
    <span class="c1"># terminal_nodes = [, ]</span>
    <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;I&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_I</span><span class="p">))</span>
    <span class="n">num_I</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">node1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">node2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
    <span class="c1"># netlist.append(netline)</span>

    <span class="c1"># Infinite Resistor</span>
    <span class="c1"># netline = []</span>
    <span class="c1"># terminal_nodes = [grid[0, -1], grid[-1, -1]]</span>
    <span class="c1"># netline.append(&#39;R_inf&#39;)</span>
    <span class="c1"># netline += terminal_nodes</span>
    <span class="c1"># netline.append(1e6)</span>
    <span class="c1"># netlist.append(netline)</span>

    <span class="c1"># +ve &amp; -ve busbars</span>
    <span class="n">bus_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]]</span>
    <span class="k">for</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">bus_nodes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># netline = []</span>
            <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Rb&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_Rb</span><span class="p">))</span>
            <span class="n">num_Rb</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">node1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">node2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rb</span><span class="p">)</span>
            <span class="c1"># netlist.append(netline)</span>
    <span class="n">num_Rs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_Ri</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Series resistors and voltage sources</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nc</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nr</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Rs&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Ns</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="c1"># netline = []</span>
            <span class="k">if</span> <span class="n">rtype</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rtype</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                    <span class="c1"># Series resistor</span>
                    <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rtype</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_Rs</span><span class="p">))</span>
                    <span class="n">num_Rs</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">Rc</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Internal resistor</span>
                    <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rtype</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_Ri</span><span class="p">))</span>
                    <span class="n">num_Ri</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">Ri</span>
                <span class="n">node1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
                <span class="n">node2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Voltage source</span>
                <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;V&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_V</span><span class="p">))</span>
                <span class="n">num_V</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">V</span>
                <span class="n">node1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">node2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
            <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="c1"># netlist.append(netline)</span>

    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="c1"># plt.scatter(x, y, c=&#39;k&#39;)</span>
        <span class="k">for</span> <span class="n">netline</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">):</span>
            <span class="n">elem</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="o">=</span> <span class="n">netline</span>
            <span class="k">if</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
            <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
                <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
            <span class="k">elif</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span>
    <span class="c1">#        print(n1, n2)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="n">desc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
    <span class="n">node1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
    <span class="n">node2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="c1"># netlist = np.asarray(netlist, dtype=&#39;&lt;U16&#39;)</span>
    <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="o">=</span> <span class="n">_make_contiguous</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
    <span class="n">netlist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;desc&#39;</span><span class="p">:</span> <span class="n">desc</span><span class="p">,</span> <span class="s1">&#39;node1&#39;</span><span class="p">:</span> <span class="n">node1</span><span class="p">,</span> <span class="s1">&#39;node2&#39;</span><span class="p">:</span> <span class="n">node2</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
    <span class="n">toc</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setup circuit time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">netlist</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="liionpack.netlist_utils.solve_circuit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">solve_circuit</span><span class="p">(</span><span class="n">netlist</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <h5 id="liionpack.netlist_utils.solve_circuit--parameters">Parameters</h5>
<p>netlist : TYPE
    DESCRIPTION.</p>
<h5 id="liionpack.netlist_utils.solve_circuit--returns">Returns</h5>
<p>None.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\netlist_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">solve_circuit</span><span class="p">(</span><span class="n">netlist</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    netlist : TYPE</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">tic</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Name = netlist[:, 0]  # element names</span>
    <span class="c1"># N1 = netlist[:, 1].astype(int)  # Node numbers</span>
    <span class="c1"># N2 = netlist[:, 2].astype(int)</span>
    <span class="c1"># arg3 = netlist[:, 3].astype(float)  # Values</span>
    <span class="n">Name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;&lt;U16&#39;</span><span class="p">)</span>
    <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">])</span>
    <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">])</span>
    <span class="n">arg3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>  <span class="c1"># Highest node number</span>
    <span class="n">nLines</span> <span class="o">=</span> <span class="n">netlist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># &quot;m&quot; is the number of voltage sources, determined below.</span>
    <span class="n">V_elem</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="n">Name</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">V_elem</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">])</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">])</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">])</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    % We need to keep track of the number of voltage sources we&#39;ve parsed</span>
<span class="sd">    % so far as we go through file.  We start with zero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vsCnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    % This loop does the bulk of filling in the arrays.  It scans line by line</span>
<span class="sd">    % and fills in the arrays depending on the type of element found on the</span>
<span class="sd">    % current line.</span>
<span class="sd">    % See http://lpsa.swarthmore.edu/Systems/Electrical/mna/MNA3.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLines</span><span class="p">):</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">N1</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># get the two node numbers in python index format</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">N2</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">elem</span> <span class="o">=</span> <span class="n">Name</span><span class="p">[</span><span class="n">k1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">elem</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">arg3</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span>  <span class="c1"># conductance = 1 / R</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            % Here we fill in G array by adding conductance.</span>
<span class="sd">            % The procedure is slightly different if one of the nodes is</span>
<span class="sd">            % ground, so check for those accordingly.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">n1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># -1 is the ground node</span>
                <span class="n">G</span><span class="p">[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n2</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span>
            <span class="k">elif</span> <span class="n">n2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">G</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">G</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span>
                <span class="n">G</span><span class="p">[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n2</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span>
                <span class="n">G</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">]</span> <span class="o">-</span> <span class="n">g</span>
                <span class="n">G</span><span class="p">[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">n2</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g</span>
        <span class="k">elif</span> <span class="n">elem</span> <span class="o">==</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">B</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">vsCnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">vsCnt</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">n2</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">B</span><span class="p">[</span><span class="n">n2</span><span class="p">,</span> <span class="n">vsCnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">n2</span><span class="p">,</span> <span class="n">vsCnt</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">e</span><span class="p">[</span><span class="n">vsCnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">arg3</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span>
            <span class="n">vsCnt</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">elem</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">i</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span> <span class="o">-</span> <span class="n">arg3</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">n2</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">i</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span> <span class="o">+</span> <span class="n">arg3</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span>

    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">G</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">B</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">upper</span><span class="p">,</span> <span class="n">lower</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># include ground node</span>
    <span class="n">V_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">V_node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">I_batt</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span>

<span class="c1">#    print(X)</span>
    <span class="n">toc</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solve circuit time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">V_node</span><span class="p">,</span> <span class="n">I_batt</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="liionpack.protocols" class="doc doc-heading">
        <code>protocols</code>



</h2>

    <div class="doc doc-contents ">

      <p>Created on Thu Sep 23 14:44:19 2021</p>
<p>@author: Tom</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h3 id="liionpack.protocols.generate_protocol" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generate_protocol</span><span class="p">(</span><span class="n">I_dch</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">I_chg</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">t_dch</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">t_chg</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">t_rest</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">chg_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <h5 id="liionpack.protocols.generate_protocol--parameters">Parameters</h5>
<p>I_dch : float
    Negative discharge current [A]. The default is -50.
I_chg : float
    Positive charge current [A]. The default is 50.
t_dch : int
    number of time steps to discharge. The default is 180.
t_chg : int
    number of time steps to charge. The default is 180.
t_rest : int, optional
    number of time steps to rest inbetween charge and discharge.
    The default is 90.
chg_first : bool
    charge before discharge. The default is True</p>
<h5 id="liionpack.protocols.generate_protocol--returns">Returns</h5>
<p>proto : list
    a sequence of terminal currents to apply at each timestep</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\protocols.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_protocol</span><span class="p">(</span><span class="n">I_dch</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">I_chg</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">t_dch</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">t_chg</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">t_rest</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                      <span class="n">chg_first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    I_dch : float</span>
<span class="sd">        Negative discharge current [A]. The default is -50.</span>
<span class="sd">    I_chg : float</span>
<span class="sd">        Positive charge current [A]. The default is 50.</span>
<span class="sd">    t_dch : int</span>
<span class="sd">        number of time steps to discharge. The default is 180.</span>
<span class="sd">    t_chg : int</span>
<span class="sd">        number of time steps to charge. The default is 180.</span>
<span class="sd">    t_rest : int, optional</span>
<span class="sd">        number of time steps to rest inbetween charge and discharge.</span>
<span class="sd">        The default is 90.</span>
<span class="sd">    chg_first : bool</span>
<span class="sd">        charge before discharge. The default is True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    proto : list</span>
<span class="sd">        a sequence of terminal currents to apply at each timestep</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">chg_first</span><span class="p">:</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="p">[</span><span class="n">I_chg</span><span class="p">]</span> <span class="o">*</span> <span class="n">t_chg</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t_rest</span> <span class="o">+</span> <span class="p">[</span><span class="n">I_dch</span><span class="p">]</span> <span class="o">*</span> <span class="n">t_dch</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t_rest</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="p">[</span><span class="n">I_dch</span><span class="p">]</span> <span class="o">*</span> <span class="n">t_dch</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t_rest</span> <span class="o">+</span> <span class="p">[</span><span class="n">I_chg</span><span class="p">]</span> <span class="o">*</span> <span class="n">t_chg</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t_rest</span>
    <span class="k">return</span> <span class="n">proto</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="liionpack.protocols.test_protocol" class="doc doc-heading">
<code class="highlight language-python"><span class="n">test_protocol</span><span class="p">()</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>retun a simple test protocol with no options</p>
<h5 id="liionpack.protocols.test_protocol--returns">Returns</h5>
<p>proto : list
    a test sequence of terminal currents to apply at each timestep.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\protocols.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">test_protocol</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    retun a simple test protocol with no options</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    proto : list</span>
<span class="sd">        a test sequence of terminal currents to apply at each timestep.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">generate_protocol</span><span class="p">(</span><span class="n">I_dch</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">I_chg</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">t_dch</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">t_chg</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">t_rest</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="liionpack.sim_utils" class="doc doc-heading">
        <code>sim_utils</code>



</h2>

    <div class="doc doc-contents ">

      <p>Created on Thu Sep 23 10:41:16 2021</p>
<p>@author: Tom</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h3 id="liionpack.sim_utils.create_init_funcs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_init_funcs</span><span class="p">(</span><span class="n">parameter_values</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <h5 id="liionpack.sim_utils.create_init_funcs--parameters">Parameters</h5>
<p>parameter_values : TYPE, optional
    DESCRIPTION. The default is None.</p>
<h5 id="liionpack.sim_utils.create_init_funcs--returns">Returns</h5>
<p>None.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\sim_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_init_funcs</span><span class="p">(</span><span class="n">parameter_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_values : TYPE, optional</span>
<span class="sd">        DESCRIPTION. The default is None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">V_upper_limit</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="p">[</span><span class="s1">&#39;Upper voltage cut-off [V]&#39;</span><span class="p">]</span>
    <span class="n">V_lower_limit</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="p">[</span><span class="s1">&#39;Lower voltage cut-off [V]&#39;</span><span class="p">]</span>

    <span class="c1"># Make sure we slow charge to upper limit and establish equilibrium</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">pybamm</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;Charge at C/50 until </span><span class="si">{</span><span class="n">V_upper_limit</span><span class="si">}</span><span class="s2">V (10 second period)&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Hold at </span><span class="si">{</span><span class="n">V_upper_limit</span><span class="si">}</span><span class="s2">V until 0.5mA (10 second period)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Rest for 30 minutes (1 minute period)&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Discharge at C/100 until </span><span class="si">{</span><span class="n">V_lower_limit</span><span class="si">}</span><span class="s2">V (1 minute period)&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># sim.set_up_experiment(model, experiment)</span>
    <span class="c1"># sim = pybamm.Simulation(model=model, parameter_values=param, experiment=experiment)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">lp</span><span class="o">.</span><span class="n">create_simulation</span><span class="p">(</span><span class="n">parameter_values</span><span class="o">=</span><span class="n">parameter_values</span><span class="p">,</span>
                               <span class="n">experiment</span><span class="o">=</span><span class="n">experiment</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
    <span class="c1"># sim.plot()</span>

    <span class="c1"># param = sim.parameter_values</span>

    <span class="c1"># Save concentrations for initial conditions</span>

    <span class="n">neg_surf</span> <span class="o">=</span> <span class="s1">&#39;X-averaged negative particle surface concentration [mol.m-3]&#39;</span>
    <span class="n">pos_surf</span> <span class="o">=</span> <span class="s1">&#39;X-averaged positive particle surface concentration [mol.m-3]&#39;</span>
    <span class="n">sol_charged</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">cycles</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">v_upper_lim_neg</span> <span class="o">=</span> <span class="n">sol_charged</span><span class="p">[</span><span class="n">neg_surf</span><span class="p">]</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">v_upper_lim_pos</span> <span class="o">=</span> <span class="n">sol_charged</span><span class="p">[</span><span class="n">pos_surf</span><span class="p">]</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Save lower concentrations</span>
    <span class="n">sol_dischg</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">cycles</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">v_lower_lim_neg</span> <span class="o">=</span> <span class="n">sol_dischg</span><span class="p">[</span><span class="n">neg_surf</span><span class="p">]</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">v_lower_lim_pos</span> <span class="o">=</span> <span class="n">sol_dischg</span><span class="p">[</span><span class="n">pos_surf</span><span class="p">]</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Use max conc. for normalization</span>
    <span class="n">c_s_n_max</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="p">[</span><span class="s1">&#39;Maximum concentration in negative electrode [mol.m-3]&#39;</span><span class="p">]</span>
    <span class="n">c_s_p_max</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="p">[</span><span class="s1">&#39;Maximum concentration in positive electrode [mol.m-3]&#39;</span><span class="p">]</span>

    <span class="c1"># These are now the min and max concs for full range of SoC</span>
    <span class="n">x_n_max</span> <span class="o">=</span> <span class="n">v_upper_lim_neg</span> <span class="o">/</span> <span class="n">c_s_n_max</span>
    <span class="n">x_p_min</span> <span class="o">=</span> <span class="n">v_upper_lim_pos</span> <span class="o">/</span> <span class="n">c_s_p_max</span>
    <span class="n">x_n_min</span> <span class="o">=</span> <span class="n">v_lower_lim_neg</span> <span class="o">/</span> <span class="n">c_s_n_max</span>
    <span class="n">x_p_max</span> <span class="o">=</span> <span class="n">v_lower_lim_pos</span> <span class="o">/</span> <span class="n">c_s_p_max</span>


    <span class="c1"># Work out total capacity between voltage lims</span>

    <span class="n">current</span> <span class="o">=</span> <span class="n">sol_dischg</span><span class="p">[</span><span class="s1">&#39;Current [A]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">entries</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">sol_dischg</span><span class="p">[</span><span class="s1">&#39;Time [h]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">entries</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">time</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">c_ave</span> <span class="o">=</span> <span class="p">(</span><span class="n">current</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">current</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">c_ave</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">charge</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [h]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Charge Transferred [Ah]&#39;</span><span class="p">)</span>

    <span class="n">SoC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">x_n</span> <span class="o">=</span> <span class="n">x_n_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">x_n_max</span> <span class="o">-</span> <span class="n">x_n_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">SoC</span>
    <span class="n">x_p</span> <span class="o">=</span> <span class="n">x_p_max</span> <span class="o">-</span> <span class="p">(</span><span class="n">x_p_max</span> <span class="o">-</span> <span class="n">x_p_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">SoC</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ocp are functions</span>
        <span class="n">U_n</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="p">[</span><span class="s1">&#39;Negative electrode OCP [V]&#39;</span><span class="p">]</span>
        <span class="n">U_p</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="p">[</span><span class="s1">&#39;Positive electrode OCP [V]&#39;</span><span class="p">]</span>
        <span class="n">U_n_eval</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">U_n</span><span class="p">(</span><span class="n">pybamm</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">x_n</span><span class="p">)))</span>
        <span class="n">U_p_eval</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">U_p</span><span class="p">(</span><span class="n">pybamm</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">x_p</span><span class="p">)))</span>
        <span class="n">OCV</span> <span class="o">=</span> <span class="n">U_p_eval</span> <span class="o">-</span> <span class="n">U_n_eval</span>
        <span class="n">OCV</span> <span class="o">=</span> <span class="n">OCV</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># Ocp is data</span>
        <span class="c1"># Get the OCP data and plot it from the parameters</span>
        <span class="n">neg_ocp</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="p">[</span><span class="s1">&#39;Negative electrode OCP [V]&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pos_ocp</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="p">[</span><span class="s1">&#39;Positive electrode OCP [V]&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Split the data</span>
        <span class="n">neg_x</span> <span class="o">=</span> <span class="n">neg_ocp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">neg_y</span> <span class="o">=</span> <span class="n">neg_ocp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">pos_x</span> <span class="o">=</span> <span class="n">pos_ocp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">pos_y</span> <span class="o">=</span> <span class="n">pos_ocp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># plt.figure()</span>
        <span class="c1"># plt.plot(neg_x, neg_y)</span>
        <span class="c1"># plt.title(&#39;Neg OCP&#39;)</span>
        <span class="c1"># plt.ylabel(&#39;OCP [V]&#39;)</span>
        <span class="c1"># plt.xlabel(&#39;Lithiation&#39;)</span>

        <span class="c1"># plt.figure()</span>
        <span class="c1"># plt.plot(pos_x, pos_y)</span>
        <span class="c1"># plt.title(&#39;Pos OCP&#39;)</span>
        <span class="c1"># plt.ylabel(&#39;OCP [V]&#39;)</span>
        <span class="c1"># plt.xlabel(&#39;Lithiation&#39;)</span>

        <span class="c1"># interpolant functions</span>
        <span class="n">U_n</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">neg_x</span><span class="p">,</span> <span class="n">neg_y</span><span class="p">)</span>
        <span class="n">U_p</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">pos_x</span><span class="p">,</span> <span class="n">pos_y</span><span class="p">)</span>

        <span class="c1"># OCV theoretical based on discharge at eqm</span>
        <span class="n">OCV</span> <span class="o">=</span> <span class="n">U_p</span><span class="p">(</span><span class="n">x_p</span><span class="p">)</span> <span class="o">-</span> <span class="n">U_n</span><span class="p">(</span><span class="n">x_n</span><span class="p">)</span>

    <span class="c1"># Compare to C/100</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SoC</span><span class="p">,</span> <span class="n">OCV</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;OCP [V]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;SoC&#39;</span><span class="p">)</span>
    <span class="n">terminal</span> <span class="o">=</span> <span class="n">sol_dischg</span><span class="p">[</span><span class="s1">&#39;Terminal voltage [V]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">entries</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">terminal</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">terminal</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>

    <span class="c1"># Reverse interpolants to get back lithiation states from SoC and OCV</span>
    <span class="n">x_n_SoC</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">SoC</span><span class="p">,</span> <span class="n">x_n</span><span class="p">)</span>
    <span class="n">x_p_SoC</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">SoC</span><span class="p">,</span> <span class="n">x_p</span><span class="p">)</span>
    <span class="n">x_n_OCV</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">OCV</span><span class="p">,</span> <span class="n">x_n</span><span class="p">)</span>
    <span class="n">x_p_OCV</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">OCV</span><span class="p">,</span> <span class="n">x_p</span><span class="p">)</span>



    <span class="n">vmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">V_lower_limit</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">V_upper_limit</span><span class="p">)</span>

    <span class="n">init_funcs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x_n_SoC&#39;</span><span class="p">:</span><span class="n">x_n_SoC</span><span class="p">,</span>
                  <span class="s1">&#39;x_p_SoC&#39;</span><span class="p">:</span> <span class="n">x_p_SoC</span><span class="p">,</span>
                  <span class="s1">&#39;x_n_OCV&#39;</span><span class="p">:</span> <span class="n">x_n_OCV</span><span class="p">,</span>
                  <span class="s1">&#39;x_p_OCV&#39;</span><span class="p">:</span><span class="n">x_p_OCV</span><span class="p">,</span>
                  <span class="s1">&#39;c_s_n_max&#39;</span><span class="p">:</span><span class="n">c_s_n_max</span><span class="p">,</span>
                  <span class="s1">&#39;c_s_p_max&#39;</span><span class="p">:</span><span class="n">c_s_p_max</span><span class="p">,</span>
                  <span class="s1">&#39;vmin&#39;</span><span class="p">:</span><span class="n">vmin</span><span class="p">,</span>
                  <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span>
                  <span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">init_fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">init_funcs</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="liionpack.sim_utils.initial_conditions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">initial_conditions</span><span class="p">(</span><span class="n">SoC</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">OCV</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <h5 id="liionpack.sim_utils.initial_conditions--parameters">Parameters</h5>
<p>SoC : TYPE, optional
    DESCRIPTION. The default is -1.
OCV : TYPE, optional
    DESCRIPTION. The default is -1.</p>
<h5 id="liionpack.sim_utils.initial_conditions--returns">Returns</h5>
<p>c_s_n_init : TYPE
    DESCRIPTION.
c_s_p_init : TYPE
    DESCRIPTION.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\sim_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">initial_conditions</span><span class="p">(</span><span class="n">SoC</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">OCV</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SoC : TYPE, optional</span>
<span class="sd">        DESCRIPTION. The default is -1.</span>
<span class="sd">    OCV : TYPE, optional</span>
<span class="sd">        DESCRIPTION. The default is -1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    c_s_n_init : TYPE</span>
<span class="sd">        DESCRIPTION.</span>
<span class="sd">    c_s_p_init : TYPE</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">init_fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">init_funcs</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="n">x_n_SoC</span> <span class="o">=</span> <span class="n">init_funcs</span><span class="p">[</span><span class="s1">&#39;x_n_SoC&#39;</span><span class="p">]</span>
    <span class="n">x_p_SoC</span> <span class="o">=</span> <span class="n">init_funcs</span><span class="p">[</span><span class="s1">&#39;x_p_SoC&#39;</span><span class="p">]</span>
    <span class="n">x_n_OCV</span>  <span class="o">=</span> <span class="n">init_funcs</span><span class="p">[</span><span class="s1">&#39;x_n_OCV&#39;</span><span class="p">]</span>
    <span class="n">x_p_OCV</span> <span class="o">=</span> <span class="n">init_funcs</span><span class="p">[</span><span class="s1">&#39;x_p_OCV&#39;</span><span class="p">]</span>

    <span class="n">c_s_n_max</span> <span class="o">=</span> <span class="n">init_funcs</span><span class="p">[</span><span class="s1">&#39;c_s_n_max&#39;</span><span class="p">]</span>
    <span class="n">c_s_p_max</span> <span class="o">=</span> <span class="n">init_funcs</span><span class="p">[</span><span class="s1">&#39;c_s_p_max&#39;</span><span class="p">]</span>

    <span class="n">vmin</span> <span class="o">=</span> <span class="n">init_funcs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">init_funcs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">SoC</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">SoC</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">x_n_init</span> <span class="o">=</span> <span class="n">x_n_SoC</span><span class="p">(</span><span class="n">SoC</span><span class="p">)</span>
        <span class="n">x_p_init</span> <span class="o">=</span> <span class="n">x_p_SoC</span><span class="p">(</span><span class="n">SoC</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">OCV</span> <span class="o">&gt;=</span> <span class="n">vmin</span> <span class="ow">and</span> <span class="n">OCV</span> <span class="o">&lt;=</span> <span class="n">vmax</span><span class="p">:</span>
        <span class="n">x_n_init</span> <span class="o">=</span> <span class="n">x_n_OCV</span><span class="p">(</span><span class="n">OCV</span><span class="p">)</span>
        <span class="n">x_p_init</span> <span class="o">=</span> <span class="n">x_p_OCV</span><span class="p">(</span><span class="n">OCV</span><span class="p">)</span>
    <span class="n">c_s_n_init</span> <span class="o">=</span> <span class="n">x_n_init</span> <span class="o">*</span> <span class="n">c_s_n_max</span>
    <span class="n">c_s_p_init</span> <span class="o">=</span> <span class="n">x_p_init</span> <span class="o">*</span> <span class="n">c_s_p_max</span>
    <span class="k">return</span> <span class="n">c_s_n_init</span><span class="p">,</span> <span class="n">c_s_p_init</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="liionpack.sim_utils.update_init_conc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_init_conc</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">SoC</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">OCV</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <h5 id="liionpack.sim_utils.update_init_conc--parameters">Parameters</h5>
<p>sim : TYPE
    DESCRIPTION.
SoC : TYPE, optional
    DESCRIPTION. The default is -1.
OCV : TYPE, optional
    DESCRIPTION. The default is -1.</p>
<h5 id="liionpack.sim_utils.update_init_conc--returns">Returns</h5>
<p>None.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\sim_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">update_init_conc</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">SoC</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">OCV</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sim : TYPE</span>
<span class="sd">        DESCRIPTION.</span>
<span class="sd">    SoC : TYPE, optional</span>
<span class="sd">        DESCRIPTION. The default is -1.</span>
<span class="sd">    OCV : TYPE, optional</span>
<span class="sd">        DESCRIPTION. The default is -1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">parameter_values</span>
    <span class="n">c_s_n_init</span><span class="p">,</span> <span class="n">c_s_p_init</span> <span class="o">=</span> <span class="n">initial_conditions</span><span class="p">(</span><span class="n">SoC</span><span class="o">=</span><span class="n">SoC</span><span class="p">,</span> <span class="n">OCV</span><span class="o">=</span><span class="n">OCV</span><span class="p">)</span>
    <span class="n">param</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s2">&quot;Initial concentration in negative electrode [mol.m-3]&quot;</span><span class="p">:</span><span class="n">c_s_n_init</span><span class="p">,</span>
        <span class="s2">&quot;Initial concentration in positive electrode [mol.m-3]&quot;</span><span class="p">:</span><span class="n">c_s_p_init</span><span class="p">,</span>
    <span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="liionpack.simulations" class="doc doc-heading">
        <code>simulations</code>



</h2>

    <div class="doc doc-contents ">

      <p>Created on Wed Sep 22 15:37:51 2021</p>
<p>@author: tom</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h3 id="liionpack.simulations.create_simulation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_simulation</span><span class="p">(</span><span class="n">parameter_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">make_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Create a PyBaMM simulation set up for interation with liionpack</p>
<h5 id="liionpack.simulations.create_simulation--parameters">Parameters</h5>
<p>parameter_values : pybamm.ParameterValues class
    DESCRIPTION. The default is None.
experiment : pybamm.Experiment class
    DESCRIPTION. The default is None.
make_inputs : bool, optional
    Changes "Current function [A]" and "Total heat transfer coefficient
    [W.m-2.K-1]" to be inputs that are controlled by liionpack.
    The default is False.</p>
<h5 id="liionpack.simulations.create_simulation--returns">Returns</h5>
<p>sim : pybamm.Simulation
    A simulation that can be solved individually or passed into the
    liionpack solve method</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\simulations.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_simulation</span><span class="p">(</span><span class="n">parameter_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">make_inputs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a PyBaMM simulation set up for interation with liionpack</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameter_values : pybamm.ParameterValues class</span>
<span class="sd">        DESCRIPTION. The default is None.</span>
<span class="sd">    experiment : pybamm.Experiment class</span>
<span class="sd">        DESCRIPTION. The default is None.</span>
<span class="sd">    make_inputs : bool, optional</span>
<span class="sd">        Changes &quot;Current function [A]&quot; and &quot;Total heat transfer coefficient</span>
<span class="sd">        [W.m-2.K-1]&quot; to be inputs that are controlled by liionpack.</span>
<span class="sd">        The default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sim : pybamm.Simulation</span>
<span class="sd">        A simulation that can be solved individually or passed into the</span>
<span class="sd">        liionpack solve method</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Create the pybamm model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pybamm</span><span class="o">.</span><span class="n">lithium_ion</span><span class="o">.</span><span class="n">SPMe</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;thermal&quot;</span><span class="p">:</span> <span class="s2">&quot;lumped&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;external submodels&quot;: [&quot;thermal&quot;],</span>
    <span class="p">})</span>   
    <span class="c1"># geometry = model.default_geometry</span>
    <span class="k">if</span> <span class="n">parameter_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># load parameter values and process model and geometry</span>
        <span class="n">chemistry</span> <span class="o">=</span> <span class="n">pybamm</span><span class="o">.</span><span class="n">parameter_sets</span><span class="o">.</span><span class="n">Chen2020</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">pybamm</span><span class="o">.</span><span class="n">ParameterValues</span><span class="p">(</span><span class="n">chemistry</span><span class="o">=</span><span class="n">chemistry</span><span class="p">)</span>
    <span class="c1"># Change the current function to be an input as this is set by the external circuit</span>
    <span class="k">if</span> <span class="n">make_inputs</span><span class="p">:</span>
        <span class="n">parameter_values</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Current function [A]&quot;</span><span class="p">:</span> <span class="n">_current_function</span><span class="p">,})</span>
        <span class="n">parameter_values</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Current&quot;</span><span class="p">:</span> <span class="s2">&quot;[input]&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Total heat transfer coefficient [W.m-2.K-1]&quot;</span><span class="p">:</span> <span class="s2">&quot;[input]&quot;</span><span class="p">},</span>
                      <span class="n">check_already_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">solver</span> <span class="o">=</span> <span class="n">pybamm</span><span class="o">.</span><span class="n">CasadiSolver</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;safe&#39;</span><span class="p">)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">pybamm</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="n">experiment</span><span class="p">,</span>
                            <span class="n">parameter_values</span><span class="o">=</span><span class="n">parameter_values</span><span class="p">,</span>
                            <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sim</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="liionpack.solver_utils" class="doc doc-heading">
        <code>solver_utils</code>



</h2>

    <div class="doc doc-contents ">

      <p>Created on Thu Sep 23 10:44:31 2021</p>
<p>@author: Tom</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h3 id="liionpack.solver_utils.solve" class="doc doc-heading">
<code class="highlight language-python"><span class="n">solve</span><span class="p">(</span><span class="n">netlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameter_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">I_init</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">htc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nproc</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">output_variables</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Solves a pack simulation</p>
<h5 id="liionpack.solver_utils.solve--parameters">Parameters</h5>
<p>netlist : pandas.DataFrame
    A netlist of circuit elements with format. desc, node1, node2, value.
    Produced by liionpack.read_netlist or liionpack.setup_circuit
parameter_values : pybamm.ParameterValues class
    A dictionary of all the model parameters
proto : list
    a sequence of terminal currents to apply at each timestep. Produced by
    liionpack.generate_protocol
dt : float, optional
    Time interval for a single step [s]. The default is 10.
I_init : float, optional
    Initial guess for single battery current [A]. The default is 1.0.
htc : float array, optional
    Heat transfer coefficient array of length Nspm. The default is None.
nproc : int, optional
    Number of processes to start in parallel for mapping. The default is 12.
output_variables : list, optional
    Variables to evaluate during solve. Must be a valid key in the
    model.variables</p>
<h5 id="liionpack.solver_utils.solve--raises">Raises</h5>
<p>Exception
    DESCRIPTION.</p>
<h5 id="liionpack.solver_utils.solve--returns">Returns</h5>
<p>output : ndarray shape [# variable, # steps, # batteries]
    simulation output array</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\solver_utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">netlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameter_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">dt</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">I_init</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">htc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">nproc</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
          <span class="n">output_variables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Solves a pack simulation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    netlist : pandas.DataFrame</span>
<span class="sd">        A netlist of circuit elements with format. desc, node1, node2, value.</span>
<span class="sd">        Produced by liionpack.read_netlist or liionpack.setup_circuit</span>
<span class="sd">    parameter_values : pybamm.ParameterValues class</span>
<span class="sd">        A dictionary of all the model parameters</span>
<span class="sd">    proto : list</span>
<span class="sd">        a sequence of terminal currents to apply at each timestep. Produced by</span>
<span class="sd">        liionpack.generate_protocol</span>
<span class="sd">    dt : float, optional</span>
<span class="sd">        Time interval for a single step [s]. The default is 10.</span>
<span class="sd">    I_init : float, optional</span>
<span class="sd">        Initial guess for single battery current [A]. The default is 1.0.</span>
<span class="sd">    htc : float array, optional</span>
<span class="sd">        Heat transfer coefficient array of length Nspm. The default is None.</span>
<span class="sd">    nproc : int, optional</span>
<span class="sd">        Number of processes to start in parallel for mapping. The default is 12.</span>
<span class="sd">    output_variables : list, optional</span>
<span class="sd">        Variables to evaluate during solve. Must be a valid key in the</span>
<span class="sd">        model.variables</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    Exception</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output : ndarray shape [# variable, # steps, # batteries]</span>
<span class="sd">        simulation output array</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">netlist</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">parameter_values</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Please supply a netlist, paramater_values and protocol&#39;</span><span class="p">)</span>


    <span class="c1"># Get netlist indices for resistors, voltage sources, current sources</span>
    <span class="n">Ri_map</span> <span class="o">=</span> <span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Ri&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">V_map</span> <span class="o">=</span> <span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">I_map</span> <span class="o">=</span> <span class="n">netlist</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">Nspm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">V_map</span><span class="p">)</span>

    <span class="n">Nsteps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">protocol</span><span class="p">)</span>

    <span class="c1"># Solve the circuit to initialise the electrochemical models</span>
    <span class="n">V_node</span><span class="p">,</span> <span class="n">I_batt</span> <span class="o">=</span> <span class="n">lp</span><span class="o">.</span><span class="n">solve_circuit</span><span class="p">(</span><span class="n">netlist</span><span class="p">)</span>

    <span class="n">sim</span> <span class="o">=</span> <span class="n">lp</span><span class="o">.</span><span class="n">create_simulation</span><span class="p">(</span><span class="n">parameter_values</span><span class="p">,</span> <span class="n">make_inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">lp</span><span class="o">.</span><span class="n">update_init_conc</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">SoC</span><span class="o">=</span><span class="mf">0.14</span><span class="p">)</span>

    <span class="n">v_cut_lower</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="p">[</span><span class="s1">&#39;Lower voltage cut-off [V]&#39;</span><span class="p">]</span>
    <span class="n">v_cut_higher</span> <span class="o">=</span> <span class="n">parameter_values</span><span class="p">[</span><span class="s1">&#39;Upper voltage cut-off [V]&#39;</span><span class="p">]</span>

    <span class="c1"># The simulation output variables calculated at each step for each battery</span>
    <span class="c1"># Must be a 0D variable i.e. battery wide volume average - or X-averaged for 1D model</span>
    <span class="n">variable_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Terminal voltage [V]&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Measured battery open circuit voltage [V]&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Local ECM resistance [Ohm]&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">output_variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">output_variables</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">out</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variable_names</span><span class="p">:</span>
                <span class="n">variable_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="c1"># variable_names = variable_names + output_variables</span>
    <span class="n">Nvar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variable_names</span><span class="p">)</span>
    <span class="c1"># Storage variables for simulation data</span>
    <span class="n">shm_i_app</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nsteps</span><span class="p">,</span> <span class="n">Nspm</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">shm_Ri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nsteps</span><span class="p">,</span> <span class="n">Nspm</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nvar</span><span class="p">,</span> <span class="n">Nsteps</span><span class="p">,</span> <span class="n">Nspm</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># Initialize currents in battery models</span>
    <span class="n">shm_i_app</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">I_batt</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>


    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">Nsteps</span>
    <span class="n">step_solutions</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">Nspm</span>
    <span class="n">V_terminal</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">record_times</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="n">integrator</span><span class="p">,</span> <span class="n">variables_fn</span><span class="p">,</span> <span class="n">t_eval</span> <span class="o">=</span> <span class="n">_create_casadi_objects</span><span class="p">(</span><span class="n">I_init</span><span class="p">,</span> <span class="n">htc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                              <span class="n">sim</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">Nspm</span><span class="p">,</span>
                                                              <span class="n">nproc</span><span class="p">,</span>
                                                              <span class="n">variable_names</span><span class="p">)</span>


    <span class="n">sim_start_time</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="n">tic</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">step_solutions</span><span class="p">,</span> <span class="n">var_eval</span> <span class="o">=</span> <span class="n">_mapped_step</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">built_model</span><span class="p">,</span> <span class="n">step_solutions</span><span class="p">,</span>
                                                <span class="n">lp</span><span class="o">.</span><span class="n">build_inputs_dict</span><span class="p">(</span><span class="n">shm_i_app</span><span class="p">[</span><span class="n">step</span><span class="p">,</span> <span class="p">:],</span> <span class="n">htc</span><span class="p">),</span>
                                                <span class="n">integrator</span><span class="p">,</span> <span class="n">variables_fn</span><span class="p">,</span> <span class="n">t_eval</span><span class="p">)</span>
        <span class="n">output</span><span class="p">[:,</span> <span class="n">step</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">var_eval</span>

        <span class="n">time</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="c1"># Calculate internal resistance and update netlist</span>
        <span class="n">temp_v</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">temp_ocv</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">temp_Ri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">shm_Ri</span><span class="p">[</span><span class="n">step</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">temp_Ri</span>


        <span class="n">netlist</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">V_map</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">temp_ocv</span>
        <span class="n">netlist</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Ri_map</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">temp_Ri</span>
        <span class="n">netlist</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">I_map</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stepping time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">tic</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">temp_v</span> <span class="o">&lt;</span> <span class="n">v_cut_lower</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Low V limit reached&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">temp_v</span> <span class="o">&gt;</span> <span class="n">v_cut_higher</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;High V limit reached&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="n">record_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="n">V_node</span><span class="p">,</span> <span class="n">I_batt</span> <span class="o">=</span> <span class="n">lp</span><span class="o">.</span><span class="n">solve_circuit</span><span class="p">(</span><span class="n">netlist</span><span class="p">)</span>
            <span class="n">shm_i_app</span><span class="p">[</span><span class="n">step</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">I_batt</span><span class="p">[:]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">V_terminal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V_node</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>  

    <span class="c1"># Plots</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Nspm</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nspm</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">shm_i_app</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">step</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Currents&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nvar</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nspm</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">step</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">variable_names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">record_times</span><span class="p">,</span> <span class="n">V_terminal</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;simulation&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Pack terminal voltage [V]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">toc</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solve circuit time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">sim_start_time</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="liionpack.utils" class="doc doc-heading">
        <code>utils</code>



</h2>

    <div class="doc doc-contents ">

      <p>Created on Thu Sep 23 10:33:13 2021</p>
<p>@author: Tom</p>



  <div class="doc doc-children">












  <div class="doc doc-object doc-function">



<h3 id="liionpack.utils.build_inputs_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_inputs_dict</span><span class="p">(</span><span class="n">I_batt</span><span class="p">,</span> <span class="n">htc</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Function to convert inputs and external_variable arrays to list of dicts
As expected by the casadi solver. These are then converted back for mapped
solving but stored individually on each returned solution.
Can probably remove this process later</p>
<h5 id="liionpack.utils.build_inputs_dict--parameters">Parameters</h5>
<p>I_batt : float array
    The input current for each battery.
htc : float array
    the heat transfer coefficient for each battery.</p>
<h5 id="liionpack.utils.build_inputs_dict--returns">Returns</h5>
<p>inputs_dict : list
    each element of the list is an inputs dictionary corresponding to each
    battery.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">build_inputs_dict</span><span class="p">(</span><span class="n">I_batt</span><span class="p">,</span> <span class="n">htc</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to convert inputs and external_variable arrays to list of dicts</span>
<span class="sd">    As expected by the casadi solver. These are then converted back for mapped</span>
<span class="sd">    solving but stored individually on each returned solution.</span>
<span class="sd">    Can probably remove this process later</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    I_batt : float array</span>
<span class="sd">        The input current for each battery.</span>
<span class="sd">    htc : float array</span>
<span class="sd">        the heat transfer coefficient for each battery.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    inputs_dict : list</span>
<span class="sd">        each element of the list is an inputs dictionary corresponding to each</span>
<span class="sd">        battery.</span>


<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">inputs_dict</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I_batt</span><span class="p">)):</span>
        <span class="n">inputs_dict</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="c1"># &#39;Volume-averaged cell temperature&#39;: T_batt[i],</span>
            <span class="s2">&quot;Current&quot;</span><span class="p">:</span> <span class="n">I_batt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="s2">&quot;Total heat transfer coefficient [W.m-2.K-1]&quot;</span><span class="p">:</span> <span class="n">htc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">})</span>
    <span class="k">return</span> <span class="n">inputs_dict</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="liionpack.utils.get_interpolated_htc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_interpolated_htc</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>A very bespoke function that is called in the solve process to update the
heat transfer coefficients for every battery</p>
<h5 id="liionpack.utils.get_interpolated_htc--parameters">Parameters</h5>
<p>funcs : list
    each element of the list is an interpolant function.
T : float array
    The temperature of each battery.
Q : float
    The flow rate for the system.</p>
<h5 id="liionpack.utils.get_interpolated_htc--returns">Returns</h5>
<p>htc : float
    Heat transfer coefficient for each battery.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_interpolated_htc</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A very bespoke function that is called in the solve process to update the</span>
<span class="sd">    heat transfer coefficients for every battery</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    funcs : list</span>
<span class="sd">        each element of the list is an interpolant function.</span>
<span class="sd">    T : float array</span>
<span class="sd">        The temperature of each battery.</span>
<span class="sd">    Q : float</span>
<span class="sd">        The flow rate for the system.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    htc : float</span>
<span class="sd">        Heat transfer coefficient for each battery.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ncell</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">htc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncell</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncell</span><span class="p">):</span>
        <span class="n">htc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcs</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">htc</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="liionpack.utils.interp_current" class="doc doc-heading">
<code class="highlight language-python"><span class="n">interp_current</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Returns an interpolation function for current w.r.t time</p>
<h5 id="liionpack.utils.interp_current--parameters">Parameters</h5>
<p>df : pandas.DataFrame or Dict
    Contains data for 'Time' and 'Cells Total Current' from which to
    construct an interpolant function</p>
<h5 id="liionpack.utils.interp_current--returns">Returns</h5>
<p>f : function
    interpolant function of total cell current with time.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">interp_current</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns an interpolation function for current w.r.t time</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pandas.DataFrame or Dict</span>
<span class="sd">        Contains data for &#39;Time&#39; and &#39;Cells Total Current&#39; from which to</span>
<span class="sd">        construct an interpolant function</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    f : function</span>
<span class="sd">        interpolant function of total cell current with time.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Cells Total Current&#39;</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="liionpack.utils.read_cfd_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_cfd_data</span><span class="p">(</span><span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;cfd_data.xlsx&#39;</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>A very bespoke function to read heat transfer coefficients from an excel
file</p>
<h5 id="liionpack.utils.read_cfd_data--parameters">Parameters</h5>
<p>data_dir : str, optional
    Path to data file. The default is None. If unspecified the module
    liionpack.DATA_DIR folder will be used
filename : str, optional
    DESCRIPTION. The default is 'cfd_data.xlsx'.</p>
<h5 id="liionpack.utils.read_cfd_data--returns">Returns</h5>
<p>funcs : list
    an interpolant is returned for each cell in the excel file.</p>

        <details class="quote">
          <summary>Source code in <code>liionpack\utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">read_cfd_data</span><span class="p">(</span><span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;cfd_data.xlsx&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A very bespoke function to read heat transfer coefficients from an excel</span>
<span class="sd">    file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_dir : str, optional</span>
<span class="sd">        Path to data file. The default is None. If unspecified the module</span>
<span class="sd">        liionpack.DATA_DIR folder will be used</span>
<span class="sd">    filename : str, optional</span>
<span class="sd">        DESCRIPTION. The default is &#39;cfd_data.xlsx&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    funcs : list</span>
<span class="sd">        an interpolant is returned for each cell in the excel file.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">data_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_dir</span> <span class="o">=</span> <span class="n">liionpack</span><span class="o">.</span><span class="n">DATA_DIR</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">ncells</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">flow_bps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span>
                                      <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;massflow_bps&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
    <span class="n">temp_bps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span>
                                      <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;temperature_bps&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
    <span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">temp_bps</span><span class="p">,</span> <span class="n">flow_bps</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_bps</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">flow_bps</span><span class="p">),</span> <span class="n">ncells</span><span class="p">])</span>
    <span class="n">funcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncells</span><span class="p">):</span>
        <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span>
                                               <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
        <span class="n">funcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp2d</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span> <span class="n">yv</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">funcs</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../contributing/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Contributing" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Contributing
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.f8263e09.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.4fc53ad4.min.js"></script>
      
    
  </body>
</html>